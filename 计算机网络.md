# 计算机网络期末预习

## 第一章 导论

### 计算机网络的概念

计算机网络是自主（自治）的计算机通过通信技术(通信线路和通信设备)互连起来的集合体



将处于不同地理位置、独立存在的计算机，通过通信设备和线路连接起来，利用功能完善的网络软件（协议、信息交换方式及网络操作系统等）实现资源共享和数据传输的系统。



**Internet**

由网络通信设备、通信线路及基于共同通信协议TCP/IP的多个计算机网络系统互联而构成的全球性计算机网络，是无特定网络疆界的网络互联的集合。

Internet的前身ARPANET实验网



### 计算机网络的应用

**商业应用**

资源共享

- 设备资源
- 数据资源
- 程序资源



**家庭应用**

- 访问远程资源（聊天室，即时通讯，在线报纸）
- P2P  peer to peer communication
  - 没有固定的客服端和服务器
- 交互式娱乐（网络游戏，视频点播）
- 电子商务



**社会问题**

互联网带来了政治、宗教、安全等各个方面的问题



### 网络硬件

本节主要讨论网络如何分类的问题



分类方式可分为：

- 按传输技术分
- 按网络的距离尺度（大小）分



#### **按传输技术分类**

1. 点对点（point to point）链路将一对单独的机器连接起来

点对点传输只有一个发送方和一个接收方，又是也叫做单播

2. 广播网络上，通信信道被网络上的所有机器所共享

广播：广播系统往往还提供将一个数据包发送给所有目标机器的可能性，只要在地址字段中
使用一个特殊的编码。如果被传输的数据包带有这样的地址编码，那么网络中的每一台机
器都将会接收该包并对其进行处理

组播：有些广播系统支持给一组机器发送数据包的模式



#### **按网络的距离尺度进行网络分类**

**个域网PAN**

Personal Area Network 

允许设备围绕着一个人进行通信

蓝牙

**局域网LAN**

Local Area Network

局域网是一种私有网络，一般在一座建筑物内或建筑物附近，被广泛用来连接个人计算机和消费类电子设备

三个特征：

- 范围
- 传输技术
  - 有线传输
  - 无线传输
- 拓扑结构
  - 点对点链路为基础的有线局域网，俗称`以太网Ethernet`



**城域网MAN**

Metropolitan Area Networks

范围可覆盖一个城市，最有名的城域网是许多城市都有的有限电视网



**广域网WAM**

Wide Area Network

范围很大，能跨越很大的物理区域，一个国家、地区、甚至一个大陆



**互联网络**

一组相互连接的网络称为互联网络，或者互联网internet (注意，小写)

 因特网Internet



### 网络软件

#### 协议层次结构

为了降低网络设计的复杂性，大多数网络都组织成一个**层次栈**(a stack of layer)或**分级栈**(a stack of level)，每一层都建立在其下一层的基础上。

每一层的目的都是向上一层提供特定的服务，而把如何实现这些服务的细节对上一层加以屏蔽

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.png)

**几个相关概念**

协议protocol ：通信双方就如何进行通信的一种约定

对等实体peer：不同机器上构成相应层次的实体

接口interface：在每一对相邻层次之间的是接口，定义了下层为上层提供哪些原语操作和服务

网络体系结构：层和协议的集合

协议栈：一个特定系统所使用的一组协议，每一层一个协议，称为协议栈



**计算机网络为什么采取分层次的结构？**

计算机网络采用分层结构，主要是为了实现模块化设计，简化理解和实现，促进标准化和互操作性，以及提供灵活性。这样可以方便地进行升级或替换，同时保证了不同设备和软件的兼容性。



#### 层次设计问题

**可靠性问题**

`检错`(error detection)从接收信息中发现错误的一种机制

`纠错`(error correction)

`路由`(routing) 找到通过网络的工作路径，网络应该能自动做出这种路由决策

**网络演进问题**

网络的每一层在特定的消息中都需要一种机制来标识发送方和接收方

这种机制在下层分别称为`寻址`和`命名`

`网络互联`（internetworking）

**资源分配问题**

`统计复用`(statistical multiplexing) 根据统计需求来共享带宽

`流量控制`(flow control) 如何保持快速发送方不会用数据把慢速接收方淹没

`拥塞`(congestion) 计算机要发送太多的流量，网络没有能里传递所有的数据包

`服务质量`(QOS)

**安全性问题**

`保密性`

`认证`

`完整性`



#### 面向连接和无连接服务

**面向连接的服务**

为了使用面向连接的网络服务，服务用户首先必须建立一个连接，然后使用该连接传输数据，最后释放该连接,绝大数情况下，数据都是保序的

- 建立连接
- 数据传输
- 释放连接

向连接服务的在数据传输过程中，各分组可以不携带目的结点的地址

面向连接数据传输的收发数据顺序不变，传输可靠性好，但是协议复杂，通信效率不高

**无连接服务**

两个实体之间的通信不需要先建立好连接

是一种不可靠的服务。这种服务常被描述为“尽最大努力交付”(best effort delivery)或“尽力而为”。



无连接服务的每个分组都携带完整的目的结点地址，各分组在系统中是独立传送的；

数据分组传输过程中，目的结点接收的数据分组可能出现乱序、重复与丢失的现象

无连接服务的可靠性不好，但是协议相对简单，通信效率较高



**四种通信协议**

面向连接和确认服务

面向连接和不确认服务

无连接与确认服务

无连接与不确认服务



#### 服务原语

一个服务就是由一组原语的操作来描述的



用户进程通过这些原语操作，使用服务



简单面向连接服务提供的六个服务原语

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%9C%8D%E5%8A%A1%E5%8E%9F%E8%AF%AD.png)



#### 服务和原语的关系

服务：

- 各层为它上层提供一组原语(操作)
- 竖直的
- 做什么？

协议：

- 定义同层对等实体之间交换的帧、分组和报文的格式以及有意义的一组规则

- 水平的
- 怎么做？



### 参考模型

#### OSI参考模型

- 物理层

利用传输介质为通信的网络结点之间建立、管理和释放物理连接；

实现比特流的透明传输，为数据链路层提供数据传输服务；

物理层的数据传输单元是比特

- 数据链路层

在物理层提供的服务基础上，数据链路层在通信的实体间建立数据链路连接；

传输以“帧”为单位的数据包；

采用差错控制与流量控制方法，使有差错的物理线路变成无差错的数据链路。

- 网络层

通过路由选择算法为分组通过通信子网选择最适当的路径；

为数据在结点之间传输创建逻辑链路；

实现拥塞控制、保证网络服务质量等功能。

- 传输层

向用户提供可靠端到端（end-to-end）服务；

处理数据包错误、数据包次序，以及其他一些关键传输问题；

传输层向高层屏蔽了下层数据通信的细节，是计算机通信体系结构中关键的一层。

- 会话层

负责维护两个结点之间的传输链接，以便确保点到点传输不中断；

管理数据交换。

- 表示层

用于处理在两个通信系统中交换信息的表示方式；

数据格式变换；

数据加密与解密；

数据压缩与恢复

- 应用层

为应用程序提供了网络服务;

应用层需要识别并保证通信对方的可用性，使得协同工作的应用程序之间的同步;

建立传输错误纠正与保证数据完整性的控制机制

明确了3个主要概念：服务、接口、协议，并且定义清晰协议有很好的隐藏性  //服务与协议的分离

产生在协议发明之前

共有7层

网络层：连接和无连接

传输层：面向连接

#### TCP/IP 模型

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCPIP%E6%A8%A1%E5%9E%8B.png)

没有明确区分：服务、接口、协议

产生在协议发明之后

共有4层

网络层：无连接（IP）

传输层：面向连接（TCP）和无连接（UDP）



#### 混合模型

本书使用的模型

- 应用层
- 传输层
- 网络层
- 数据链路层
- 物理层



## 第二章 物理层

### 数据通信理论基础

#### 带宽有限的信号

传输设施对不同的傅里叶分量的衰减程度并不相同，从而导致接收端收到的结果信号发生变形。

一般情况下对导线而言，在0到某个频率fc这段范围内，政府在传输过程中不会衰减，这段在传输过程中振幅不会明显减弱的频率的宽度就叫**带宽**

通常引用的带宽是指从0到使得接收能力保留一般的那个频率位置

带宽是一种物理特性



一般将从0到某个最大频率的信号称为`基带`信号

被搬移并占用某个更大频率范围的信号叫做`通带`信号



带宽的两种不同含义

模拟带宽，以Hz来度量

数字带宽，一个信道的最大数据速率，以每秒多少个比特来计量

应根据上下文确定，所说的是什么带宽

#### 信道的最大数据速率

注：不适用于光纤，光纤的带宽无限大

**奈奎斯特定理**

有限带宽、无噪声信道的最大数据传输率
$$
Max~data~rate=2Hlog_2^V
$$
H是信道带宽，V是离散等级(二进制信号为2，四进制信号为4)



**香农定理**

有噪声信道的最大数据传输率

在带宽为H的有噪声信道中，信噪比为S/N

S是信号功率，N是噪声功率 
$$
Max~data~rate=Hlog_{2}^{1+\frac{S}{N}}
$$

$$
分贝:10log_{10}^{S/N}
$$

信噪比为一百，20分贝



### 引导性传输介质

#### 磁介质(Magnetic Media)

将数据从一台机器传输到另一台机器的最常见办法是将数据写到磁带或其他可擦写介质上(例如可刻录 DVD)，然后用物理的方法将磁带或者磁盘运送到目标机器，再将数据从磁带或磁盘里读出来。



从某种意义上，这样传输数据的带宽很高??

#### 双绞线(Twisted Pair)

双绞线由两根相互绝缘的铜线组成

why?

两根线绞在一起后，不同电线产生的干扰波就会相互抵消，从而显著降低电线的辐射



双绞线可以传输模拟信号，也可以用于传输数字信号



**双绞线分类**

- 3类线(Category 3)

- 5类线(Category 5)
- 6类线
- 7类线

五类线,四对双绞线套在一个塑料保护壳里



- UTP 非屏蔽双绞线
- STP 屏蔽双绞线

在每对双绞线外面加了一个屏蔽层，然后再整个线缆外面再加一个屏蔽层

屏蔽层能够减弱外部干扰和来自附近线缆的串扰

**一些术语**

`全双工链路`(full-deplex): 可以双向同时使用的链路

`半双工链路`(half-duplex):可以双向使用但一次只能使用一个方向的链路

`单工链路`(simplex)：只允许一个方向上传输的链路



#### 同轴电缆(Coaxial Cable)

两种广泛使用的同轴电缆：

- 基带(baseband)同轴电缆
  - 50Ω电缆– 数字传输
  - 75Ω电缆– 模拟传输

- 宽带(broadband)同轴电缆
  - 75Ω电缆-模拟传输、有线电视、多信道
  - 宽带网络：双电缆系统、单电缆系统



#### 光纤 Fiber Optics

**工作原理**：全内反射



光纤传输的三要素：

- 光源Light Source
- 传输介质：光纤
- 检测器Detector：光电二极管



**光缆**

- 单模光纤
- 多模光纤



#### 光纤和铜线的比较

光纤的优点：

- 带宽高、衰减小、抗干扰、轻、安全性高
- 几乎无线的带宽

光纤的缺点

- 技术陌生，容易损坏
- 全双工或半双工，取决于两端的接口设备
- 成本高





### 公共电话交换网络

#### 电话系统结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%AF%9D%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84.png)

a.全连通网络

b.中心交换网络

c.两层体系结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%AF%9D%E8%B7%AF%E7%94%B1.png)

每部电话机有两根铜线直接连接到电话公司最近的端局(end office),端局也叫做本地中心局。电话机与短句之间的双线连接在电话行业中称为**本地回路**(local loop)

电话系统由以下三个主要部分构成：

1. 本地回路(进入家庭和公司的模拟双绞线)
2. 中继线(连接交换局的数字光纤)
3. 交换局(电话呼叫在这里从一条中继线被介入另一条中间西安)



#### 本地回路：调制解调器、ADSL和光纤

##### 电话调制解调器

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%B0%83%E5%88%B6%E8%A7%A3%E8%B0%83%E5%99%A8.png)

要在本地回路或任何其他物理信道上发送比特，必须把比特转换为可在信道上传输的模拟信号。



调制解调器Modem：将数字信号转化为模拟信号

波特：每秒采样的次数

电话系统使用56kbps调制解调器,why?

- 电话信道4000Hz
- 重构信号所需的采样数是每秒8000次(根据奈奎斯特理论，只有采样频率高于原始信号最高频率的两倍时，才能把数字信号表示的信号还原成为原来信号)
- 在美国每个样本值为8比特，其中一位用作控制目的
- 7x8000=56000bit/s



编码解码器Codec：将模拟信号转化为数字吸纳后



##### 用户数字线

非对称数字用户线ADSL

使用离散多音调制的ADSL的分配

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/ADSL.png)

三个频带

信道0：用于简单老式电话服务(POTS,Plain Old Telephone Service)

信道1~5空闲，防止语音信号与数据信号相互干扰

剩下250条信道，一条用于上行流控制，另一条用于下行流控制，其他全部用于用户数据



ADSL标准:

- ANSI T.1413, ITU G.992.1
- 8Mbps Downstream
- 1Mbps Upstream



#### 中继和多路复用

##### 频分多路复用

FDM：Frequency Division Multiplexing

按频谱划分信道，不同频率的信号可以在同一信道内传输。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%A2%91%E5%88%86%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png)

**波分复用**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B3%A2%E5%88%86%E5%A4%8D%E7%94%A8.png)

WDM：Wavelength Division Multiplexing

按照波长划分信道

可以看作极高频的FDM



**时分复用**

一条物理信道按时间分成若干个时间片轮流地分配给多个信号使用

时分多路复用是将信道用于传输的时间划分为若干个时间片；

每个用户分得一个时间片；

在其占有的时间片内，用户使用通信信道的全部带宽。 



### 电路交换

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%B7%AF%E8%BF%9E%E6%8E%A5.png)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A22.png)



**包交换**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8C%85%E4%BA%A4%E6%8D%A2.png)

（非连接）路由器采用存储-转发技术，把经过它的每个数据包（根据网络线路、包的目的地址等条件）发送到通往该包目的地的路径上，没有固定的路径每个包都可以都不同的

路径，所以它们到达的顺序可能出现混乱。

出现的问题：排队延迟（queuing delay）：数据包可能会因为存在很多包要被转发而需要等待一段时间才能到它被转发，还可能引起拥塞



## 第三章 数据链路层

### 数据链路层的设计问题

数据链路层要使用物理层提供的服务在通信信道上发送和接收比特，它完成一些功能，包括：

1. 向网络层提供一个定义良好的服务接口
2. 处理传输错误
3. 调节数据流，确保慢速的接收方不会被快速的发送方淹没

为了实现这些目标,数据链路层从网络层获得数据包，然后将这些数据包封装成帧(frame)以便传输。每个帧包括一个帧头，一个有效载荷（净荷域），以及一个帧尾

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%B8%A7%E7%9A%84%E7%BB%93%E6%9E%84.png)

一个分组可能要分成多个帧



#### 提供给网络层的服务

最主要的服务是将数据从源机器的网络层传输到目标机器的网络层

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%9A%84%E6%9C%8D%E5%8A%A1.png)

三种可能的服务:

- 无确认的无连接服务

源机器向目标机器发送独立的帧，目标机器不对这些帧进行确认。不需建立逻辑连接。适用于错误率低或者实时通信（语音传输）的情况

- 有确认的无连接服务

源机器向目标机器发送独立的帧，目标机器会对这些帧进行确认。不需建立逻辑连接。适用于不可靠的信道（无线系统，WiFi）。

- 有确认的有连接服务

源机器和目标机器在传输任何一个数据之前要建立一个连接，保证目标机器按照正确的顺序接受每一个帧。适用于长距离且不可靠的链路（卫星信道，长途电话）。



#### 成帧 framing

解决两个问题：

- 帧的边界问题
- 帧的透明传输（透明）问题



四种成帧方法:

1. 字符计数法 Character count 

用头部的一个字段来标识该帧中的字符数

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%AD%97%E7%AC%A6%E8%AE%A1%E6%95%B0%E6%B3%95.png)

问题：一旦出现传输错误，就会导致后续混乱

2. 含字节填充的分界符法 Flag Bytes with byte stuffing

发送方使用标志字节（FLAG）作为开始和结束；使用转义字节（ESC）表示其后的字节为数据字节而不是标志字节或转义字节。接收方将收到的数据中的转义字节删除后再传递给网络层

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%88%86%E7%95%8C%E7%AC%A6%E6%B3%95.png)

3. 含位填充的首尾界符法Starting and ending flags,with bit stuffing

使用“01111110”表示帧的开始和结束（帧的边界问题解决）

若遇到 5 个连续的比特 1，就在其后填入一个比特 0（帧的填充问题解决）

接收方除了将首尾的“01111110”删除外，还要将数据中所有 5 个连续比特 1 其后的比特 0 删除。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%90%AB%E4%BD%8D%E5%A1%AB%E5%85%85%E7%9A%84%E9%A6%96%E4%BD%8D%E7%95%8C%E7%AC%A6%E6%B3%95.png)

4. 物理层编码违禁法 Physical layer coding violation

Bit “1”  高-低电平对

Bit “0”  低-高电平对

帧的边界（高-高，低-低）



#### 差错控制

为确保所有帧按照正确顺序传递给目标机器的网络层：

发送方发送反馈信息来确保传递可靠。

引入计时器来防止硬件故障或通信信道出错等原因丢失某一帧使发送方持续等待确认。

通过序号保证每一帧按照顺序且不会被接收方重复接收。

具体的确认方式在后面通过协议的形式来讲



#### 流量控制

发送方发送帧的速度超过了接收方能够接收这些帧的速度，而导致丢帧。

解决方法：

基于反馈的流量控制（链路层）。

基于速率的流量控制（网络层）。



### 差错检测和纠正

#### 纠错码



推断出发送的数据是什么，适用于错误发生很频繁的信道。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B5%B7%E6%98%8E%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90.png)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B5%B7%E6%98%8E%E7%A0%81%E7%9A%84%E6%8E%A5%E6%94%B6.png)

#### 检错码

检测d比特错需距离为d+1比特的编码

推断是否发生错误。适用于高度可靠的信道，错误偶尔发生时，只需重传整个数据块即可。循环冗余校验码（CRC,Cyclic Redundancy Check，也称作多项式编码）。注意有一定的误判率。

步骤：

1. 收发双方商定一个比帧短且头尾都是 1 的 01 串叫做生成多项式
2. 帧的后面附上生成多项式长度减一个 0 后，作为被除数对生成多项式模2除，得到商和余数

3. 若帧与余数合并以后在接收方被生成多项式整除，那么认为传递的过程没有出错



在接收端，再次进行同样的除法运算

只要得出的余数 R 不为 0，就表示检测到了差错

一旦检测出差错，就丢弃这个出现差错的帧



### 基本数据链路层协议

#### 实用的停等协议

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%AE%9E%E7%94%A8%E7%9A%84%E5%81%9C%E7%AD%89%E5%8D%8F%E8%AE%AE.png)



组成帧的四个字段：kind、seq、ack 和 info。前三个包含控制信息，称为帧头，最后一个可能包含了要被传输的实际数据。

**一种无限制的单工协议**(乌托邦式的单工协议)

假设

- 数据只能单向传输
- 数据链路层之间的通信信道永远不会损坏或者丢失帧
- 两端的网络层就绪
- 处理时间忽略
- 缓冲区空间 无穷大   

这是一个完全不现实（理想化）的协议，“乌托邦” 协议。

发送过程是一个无限的 while 循环，它尽可能快速地把数据放到线路上。无差错控制

或者流量控制方面的限制。接受过程一直等待一个未损坏的帧到达。（发送速率和接收速率

必须一样快



**无错信道上的单工停-等式协议**

假设：

- 单向数据传输发送方
- 网络层一直有无限的数据要发送 
- 信道不会出错，从不损坏或丢失帧

接收方发送一个响应帧，通知发送方发送下一帧

如果接收方不反馈应答信号，则发送方必须一直等待，然后就陷入等待接收方确认信息的过程中，因而传输效率低。



**有错信道上的单工停-等式协议**

- 信道有噪声
- 需要计时器与序号配合，需要超时重传机制



肯定确认的重传协议(Positive Acknowledgement with Retransmission)ACK

自动重传协议(ARQ)



#### 停等协议的要点

- 实用的 CRC 检验器都是用硬件完成的
- CRC检验器能够自动丢弃检测到的出错帧。因此所谓的“丢弃出错帧”，对上层软件或用户来说都是感觉不到的。
- 发送端对出错的数据帧进行重传是自动进行的，因而这种差错控制体制常简称为 ARQ (Automatic Repeat reQuest)，直译是自动重传请求，但意思是自动请求重传。



#### 停等协议的效率问题

- 信道利用率很低

- 一种提高效率的方法：使用更大的帧

可以使用更大的帧，但是帧的最大长度受到信道比特错误率（BER，Bit Error Ratio）的限制，帧越大，在传输中出错的概率越高，将导致更多的重传



### 滑动窗口协议

#### 基本概念

**捎带确认**(piggybacking)：暂时延缓确认以便将确认信息搭载在下一个出境数据帧上的技术。捎带确认通常与累计确认一同使用，更好的利用了信道的可用带宽。

**期望确认**:收到数据帧以后向发送方发送期望对方发送的下一帧的序号

**累计确认**（cumulative acknowledgement）：当 n 号帧的确认到达,n-1号帧、n-2号帧等都会自动被确认。

**否定确认**(NAK)：接收方检测到错误时发送的否定确认，实际是一个重传请求，在NAK中指定了要重传的帧

**发送窗口**(sending window)：发送方总维持着一组序号，分别对应于允许它发送的帧，我们称这些帧落在发送窗口。

**接收窗口**(receiving window):接收方维持着的一个窗口对应于一组允许它接受的帧



#### 一位滑动窗口协议

发送窗口大小=1，接收窗口大小=1,可保证帧的有序接收，但效率较低。

源站发送单个帧后必须等待确认，在目的站的确认到达源站之前，源站不能发送其他数据帧。这是因为发送窗口大小仅为 1，必须用来保存当前未确认的帧以超时重传。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1%E4%BD%8D%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%8D%8F%E8%AE%AE.png)

#### 回退N协议

发送窗口大小>1，接收窗口大小=1

发送方按照顺序向对方发送帧，在收到对方的确认以后窗口向后滑动，若当前窗口中的第一个帧出现超时，那么回退到这个帧重新发送所有的帧。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9B%9E%E9%80%80N%E5%8D%8F%E8%AE%AE.png)

而因为接收窗口大小为 1，除了数据链路层必须要递交给网络层的下一帧外，接收方拒绝接受任何帧。如果在计时器超时以前，发送方的窗口已被填满，则管道将变为空闲，最终，发送方将超时，并且按照顺序重传所有未被确认的帧，从那个受损或者丢失的帧开始。

一般使用累计确认



#### 选择重传协议

**发送方**

发送窗口大小$W_T$的取值范围是
$$
1< W_r\le 2^{n-1}
$$
其中，n是构成分组序号的比特数量

$W_r=1$与停-等协议相同

$W_r>2^{n-1}$ 接收方无法辨别新、旧数据分组



发送方可在未收到接收方确认分组的情况下，将序号落在发送窗口内的多个数据分组全部发送出去;



发送方只有按序收到对已发送数据分组的确认时，发送窗口才能向前相应滑动;若收到未按序到达的确认分组时，对其进行记录，以防止其相应数据分组的超时重发，但发送窗口不能向前滑动。

**接收方**

接收窗口尺寸$W_R$的取值范围
$$
1<W_R\le W_T
$$
$W_R=1$ 与停-等协议相同

$W_R>W_T$ 无意义

接收方可接收未按序到达但没有误码并且序号落在接收窗口内的数据分组;
为了使发送方仅重传出现差错的分组，接收方不能再采用累积确认，而需要对每个正确接收到的数据分组进行逐一确认!



接收方只有在按序接收数据分组后，接收窗口才能向前相应滑动。



## 第四章介质访问控制子层

### 多路访问协议



#### ALOHA

##### 纯ALOHA

基本思想：当用户有数据需要发送时就传输,如果发生冲突，则等待随机时间后，重发数据

在ALOHA系统，采用统一帧长比长度可变帧能达到更大的吞吐量



`帧时`标识传输一个标准的、固定长度的帧所需的时间


$$
S=G*e^{-2G}
$$
S:每帧时成功传输的帧数量,S$\le$1

G:每帧时的平均帧数为G

当G=0.5时，S值最大，为0.184

换句话说，信道的最好利用率为18%



##### 分槽ALOHA

将时间分成离散的间隔，这种时间间隔称为`时间槽`(slot),每个时间槽对应一帧。

用户遵守统一的时间槽边界,只有在槽的开始时刻才能发送帧
$$
S=G*e^{-G}
$$
G=1时，S取得最大值0.368

也就是说，理想状态下，信道的最好利用率为36%



#### CSMA载波监听多路访问协议

基本思想：检测其他站点，调整自己的动作，大大提高利用率



- 1-persistent CSMA

如果信道忙，则站点持续等待，直到信道空闲

如果空闲，站点立刻传输数据

如果冲突发生，站点等待随机一段时间后

- Nonpersistent CSMA

如果信道忙，等待一段时间

如果空闲，站点立即传输数据

信道利用率比1-persistent高，但是又更高的延迟

- p-persistent CSMA

如果信道繁忙，站点会连续检测介质

如果信道空闲，则它以概率p发送数据，以概率1-p将此次发送推迟到下一个时间槽

如果冲突发生，站点会等待一段随机时间

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/CSMA.png)

二进制指数后退算法

在i次冲突后，随机数在0~$2^i-1$这个范围内选取

在16次冲突后，控制器放弃并向计算机报告故障。

- 带冲突检测的CSMA CSMA/CD

如果两个站帧听到信道为空，并且同时开始传输，则它们的信号仍然会产生冲突。因此，另一个改进是每个站快速检测到发生冲突后立即停止传输帧

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/CSMA%20CD.png)

CSMA/CD模型由交替出现的**竞争期**、**传输期**，以及当所有站都静止的**空闲期**组成

假设两根相距最远的站传播信号所需要的时间为t,那么冲突检测的最长时间为2t



使用CSMA/CD协议的单信道网络不能进行全双工通信，只能进行半双工通信



以太网的端到端往返时延2t称为争用期，或碰撞窗口



以太网的最小帧长为64字节,凡小于64字节的帧都是由于冲突而异常终止的无效帧



CSMD/CD优缺点：

- 原理简单、技术上易实现，网络中各工作站处于平等地位，不需要集中控制，不提供优先级控制
- 网络负载增大时，发送时间增长，发送效率急剧下降



### 无冲突的协议

#### 基本位图法

每个竞争期包含N个槽，i号站通过在i号槽中插入1位来声明自己由帧要发送，当N个槽经过后，每个站都知道了哪些站希望发送数据，这时候，按照数字顺序开始传送数据

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E6%9C%AC%E4%BD%8D%E5%9B%BE%E5%8D%8F%E8%AE%AE.png)

效率=d/(N+d) 

N-每帧的开销，d-数据量/帧

高负荷下，效率=d/(d+1) (N=1)





#### 有限竞争协议

竞争法（如CSMA)和无冲突法的结合

低负荷时，采用竞争法，使时延较短

重负荷时，采用无冲突法，使信道利用率较高



### 以太网

在局域网中，硬件地址又称为物理地址，或MAC地址

消息的发送使用曼彻斯特编码,**实现对通信过程中收发双发的数据同步**

每一位的中间有一跳变，位中间的跳变既作时钟信号，又作数据信号

接收方利用包含有同步信号的特殊编码从信号自身提取同步信号来锁定自己的时钟脉冲频率，达到同步目的

每一个码元都被调成两个电平，所以数据传输速率只有调制速率的1/2



**两种重要措施**

- 无连接的工作方式，不必先建立连接就可以直接发送数据
- 以太网对发送的数据帧不进行编号，也不要求对方发回确认

why？局域网信道质量很好，由信道质量产生差错的概率时很小的



**以太网提供的服务**

不可靠的传输服务

当目的站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。

如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送。 



**两个标准**

- DIX Ethernet V2

- IEEE 802.3



#### 以太网MAC子层协议

##### 以太网帧结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%BB%93%E6%9E%84.png)

最常用的MAC帧是以太网V2的格式。

Destination address 目的地址

Source address 源地址

Type类型 用来标志上一层使用的是什么协议，以便把收到的MAC帧数据上交给上一层的这个协议

数据字段最小长度=64B-18B=46字节

当数据字段长度小于46字节时，要填充整数字节的填充字段，以保证以太网的MAC帧长不小于64字节

FCS字段通常用于错误检测,通过计算数据帧中的校验和,可以判断数据在传输过程中是否发生了错误

 

为了达到比特同步，在传输媒体上实际传送的要比MAC帧还多8个字节

Preamble 7字节 前同步码 1字节 帧开始定界符



**无效的MAC帧**

- 数据字段的长度与长度字段的值不一致
- 帧的长度不是整数个字节
- 用收到的帧检验序列 FCS 查出有差错
- 数据字段的长度不在 46 ~ 1500 字节之间
- 有效的 MAC 帧长度为 64 ~ 1518 字节之间



对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。 



#### 交换式以太网

以交换机为核心设备而建立起来的一种高速网络。可在高速与低速网络间转换，实现不同网络的协同。交换机分割了连接的不同网络成为不同的冲突域，不同冲突域之间信号不会彼此干扰，所以不用考虑不同自治域间的冲突问题。



#### IEEE 802.2: Logical Link Control 逻辑链路控制子层

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关，不管采用何种协议的局域网对 LLC 子层来说都是透明的 



一般不考虑LLC子层

TCP/IP 体系经常使用的局域网是 DIX Ethernet V2 而不是 802.3 标准中的几种局域网



### 无线局域网协议

无线局域网CSMA

- 隐蔽站问题

无线节点没能检测出信道上已经存在的信号而导致冲突发生

- 暴露站问题

在WLAN中,在不发生干扰的前提下允许多个节点进行通信,因检测出信道上已经存在的信号而放弃无冲突的通信

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%9A%90%E8%97%8F%E7%AB%99%E5%92%8C%E6%9A%B4%E9%9C%B2%E7%AB%99%E9%97%AE%E9%A2%98.png)

关键问题：开始一个传输之前，一个站真正希望知道的是接收方的周围是否有活动情况

**MACA冲突避免多路访问协议**

也叫CSMA/CA

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%86%B2%E7%AA%81%E9%81%BF%E5%85%8D%E5%A4%9A%E8%B7%AF%E8%AE%BF%E9%97%AE%E5%8D%8F%E8%AE%AE.png)

RTS(Request To Send)和CTS(Clear To Send)

1. A首先给B发送一个RTS帧，这个短帧包含了随后将要发送的数据帧的长度

2. B用一个CTS帧作为应答，该帧也包含了数据长度(RTS复制过来)，A在收到CTS帧之后便开始传输

3. 如果其他站听到了RTS帧，那么它一定离A很近，它必须保持沉默，至少等待足够长的时间以便在无冲突的情况下CTS返回给A

4. 如果一个站听到了CTS，则它一定离B很近，在接下来的数据传送过程中它必须一直保持沉默，只要检查 CTS帧，该站就可以知道数据帧的长度(即数据传输要持续多久)。

冲突仍有可能发生，如B和C同时给A发送RTS，发生冲突的情况下，不成功的发送方将随机等待一段时间后再重试



### 无线局域网

#### 802.11体系结构和协议栈

##### 802.11体系结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%20%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

a. 有架构模式，每个客户端与一个接入点AP关联，该接入点又与其他网络连接，客服端发送和接收数据包都要通过AP进行。几个接入点可通过一个称为分布式系统的有线网络连接在一起，形成一个扩展的802.11网络

b. 自组织网络。这种模式下的网络由一组互相关联的计算机组成，它们相互之间可以直接向对方发送帧，没有接入点。

##### 802.11协议栈

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%E5%8D%8F%E8%AE%AE%E6%A0%88.png)

介质访问控制子层MAC决定如何分配信道

逻辑链路控制子层LLC，隐藏802.11系列协议之间的差异，使它们在网络层看来并无区别



##### 802.11 MAC子层协议