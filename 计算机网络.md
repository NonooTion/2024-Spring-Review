# 计算机网络期末预习

## 第一章 导论

### 计算机网络的概念

计算机网络是自主（自治）的计算机通过通信技术(通信线路和通信设备)互连起来的集合体



将处于不同地理位置、独立存在的计算机，通过通信设备和线路连接起来，利用功能完善的网络软件（协议、信息交换方式及网络操作系统等）实现资源共享和数据传输的系统。



**Internet**

由网络通信设备、通信线路及基于共同通信协议TCP/IP的多个计算机网络系统互联而构成的全球性计算机网络，是无特定网络疆界的网络互联的集合。

Internet的前身ARPANET实验网



### 计算机网络的应用

**商业应用**

资源共享

- 设备资源
- 数据资源
- 程序资源



**家庭应用**

- 访问远程资源（聊天室，即时通讯，在线报纸）
- P2P  peer to peer communication
  - 没有固定的客服端和服务器
- 交互式娱乐（网络游戏，视频点播）
- 电子商务



**社会问题**

互联网带来了政治、宗教、安全等各个方面的问题



### 网络硬件

本节主要讨论网络如何分类的问题



分类方式可分为：

- 按传输技术分
- 按网络的距离尺度（大小）分



#### **按传输技术分类**

1. 点对点（point to point）链路将一对单独的机器连接起来

点对点传输只有一个发送方和一个接收方，又是也叫做单播

2. 广播网络上，通信信道被网络上的所有机器所共享

广播：广播系统往往还提供将一个数据包发送给所有目标机器的可能性，只要在地址字段中
使用一个特殊的编码。如果被传输的数据包带有这样的地址编码，那么网络中的每一台机
器都将会接收该包并对其进行处理

组播：有些广播系统支持给一组机器发送数据包的模式



#### **按网络的距离尺度进行网络分类**

**个域网PAN**

Personal Area Network 

允许设备围绕着一个人进行通信

蓝牙

**局域网LAN**

Local Area Network

局域网是一种私有网络，一般在一座建筑物内或建筑物附近，被广泛用来连接个人计算机和消费类电子设备

三个特征：

- 范围
- 传输技术
  - 有线传输
  - 无线传输
- 拓扑结构
  - 点对点链路为基础的有线局域网，俗称`以太网Ethernet`



**城域网MAN**

Metropolitan Area Networks

范围可覆盖一个城市，最有名的城域网是许多城市都有的有限电视网



**广域网WAM**

Wide Area Network

范围很大，能跨越很大的物理区域，一个国家、地区、甚至一个大陆



**互联网络**

一组相互连接的网络称为互联网络，或者互联网internet (注意，小写)

 因特网Internet



### 网络软件

#### 协议层次结构

为了降低网络设计的复杂性，大多数网络都组织成一个**层次栈**(a stack of layer)或**分级栈**(a stack of level)，每一层都建立在其下一层的基础上。

每一层的目的都是向上一层提供特定的服务，而把如何实现这些服务的细节对上一层加以屏蔽

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.png)

**几个相关概念**

协议protocol ：通信双方就如何进行通信的一种约定

对等实体peer：不同机器上构成相应层次的实体

接口interface：在每一对相邻层次之间的是接口，定义了下层为上层提供哪些原语操作和服务

网络体系结构：层和协议的集合

协议栈：一个特定系统所使用的一组协议，每一层一个协议，称为协议栈



**计算机网络为什么采取分层次的结构？**

计算机网络采用分层结构，主要是为了实现模块化设计，简化理解和实现，促进标准化和互操作性，以及提供灵活性。这样可以方便地进行升级或替换，同时保证了不同设备和软件的兼容性。



#### 层次设计问题

**可靠性问题**

`检错`(error detection)从接收信息中发现错误的一种机制

`纠错`(error correction)

`路由`(routing) 找到通过网络的工作路径，网络应该能自动做出这种路由决策

**网络演进问题**

网络的每一层在特定的消息中都需要一种机制来标识发送方和接收方

这种机制在下层分别称为`寻址`和`命名`

`网络互联`（internetworking）

**资源分配问题**

`统计复用`(statistical multiplexing) 根据统计需求来共享带宽

`流量控制`(flow control) 如何保持快速发送方不会用数据把慢速接收方淹没

`拥塞`(congestion) 计算机要发送太多的流量，网络没有能里传递所有的数据包

`服务质量`(QOS)

**安全性问题**

`保密性`

`认证`

`完整性`



#### 面向连接和无连接服务

**面向连接的服务**

为了使用面向连接的网络服务，服务用户首先必须建立一个连接，然后使用该连接传输数据，最后释放该连接,绝大数情况下，数据都是保序的

- 建立连接
- 数据传输
- 释放连接

向连接服务的在数据传输过程中，各分组可以不携带目的结点的地址

面向连接数据传输的收发数据顺序不变，传输可靠性好，但是协议复杂，通信效率不高

**无连接服务**

两个实体之间的通信不需要先建立好连接

是一种不可靠的服务。这种服务常被描述为“尽最大努力交付”(best effort delivery)或“尽力而为”。



无连接服务的每个分组都携带完整的目的结点地址，各分组在系统中是独立传送的；

数据分组传输过程中，目的结点接收的数据分组可能出现乱序、重复与丢失的现象

无连接服务的可靠性不好，但是协议相对简单，通信效率较高



**四种通信协议**

面向连接和确认服务

面向连接和不确认服务

无连接与确认服务

无连接与不确认服务



#### 服务原语

一个服务就是由一组原语的操作来描述的



用户进程通过这些原语操作，使用服务



简单面向连接服务提供的六个服务原语

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%9C%8D%E5%8A%A1%E5%8E%9F%E8%AF%AD.png)



#### 服务和原语的关系

服务：

- 各层为它上层提供一组原语(操作)
- 竖直的
- 做什么？

协议：

- 定义同层对等实体之间交换的帧、分组和报文的格式以及有意义的一组规则

- 水平的
- 怎么做？



### 参考模型

#### OSI参考模型

- 物理层

利用传输介质为通信的网络结点之间建立、管理和释放物理连接；

实现比特流的透明传输，为数据链路层提供数据传输服务；

物理层的数据传输单元是比特

- 数据链路层

在物理层提供的服务基础上，数据链路层在通信的实体间建立数据链路连接；

传输以“帧”为单位的数据包；

采用差错控制与流量控制方法，使有差错的物理线路变成无差错的数据链路。

- 网络层

通过路由选择算法为分组通过通信子网选择最适当的路径；

为数据在结点之间传输创建逻辑链路；

实现拥塞控制、保证网络服务质量等功能。

- 传输层

向用户提供可靠端到端（end-to-end）服务；

处理数据包错误、数据包次序，以及其他一些关键传输问题；

传输层向高层屏蔽了下层数据通信的细节，是计算机通信体系结构中关键的一层。

- 会话层

负责维护两个结点之间的传输链接，以便确保点到点传输不中断；

管理数据交换。

- 表示层

用于处理在两个通信系统中交换信息的表示方式；

数据格式变换；

数据加密与解密；

数据压缩与恢复

- 应用层

为应用程序提供了网络服务;

应用层需要识别并保证通信对方的可用性，使得协同工作的应用程序之间的同步;

建立传输错误纠正与保证数据完整性的控制机制

明确了3个主要概念：服务、接口、协议，并且定义清晰协议有很好的隐藏性  //服务与协议的分离

产生在协议发明之前

共有7层

网络层：连接和无连接

传输层：面向连接

#### TCP/IP 模型

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCPIP%E6%A8%A1%E5%9E%8B.png)

没有明确区分：服务、接口、协议

产生在协议发明之后

共有4层

网络层：无连接（IP）

传输层：面向连接（TCP）和无连接（UDP）



#### 混合模型

本书使用的模型

- 应用层
- 传输层
- 网络层
- 数据链路层
- 物理层



## 第二章 物理层

### 数据通信理论基础

#### 带宽有限的信号

传输设施对不同的傅里叶分量的衰减程度并不相同，从而导致接收端收到的结果信号发生变形。

一般情况下对导线而言，在0到某个频率fc这段范围内，政府在传输过程中不会衰减，这段在传输过程中振幅不会明显减弱的频率的宽度就叫**带宽**

通常引用的带宽是指从0到使得接收能力保留一般的那个频率位置

带宽是一种物理特性



一般将从0到某个最大频率的信号称为`基带`信号

被搬移并占用某个更大频率范围的信号叫做`通带`信号



带宽的两种不同含义

模拟带宽，以Hz来度量

数字带宽，一个信道的最大数据速率，以每秒多少个比特来计量

应根据上下文确定，所说的是什么带宽

#### 信道的最大数据速率

注：不适用于光纤，光纤的带宽无限大

**奈奎斯特定理**

有限带宽、无噪声信道的最大数据传输率
$$
Max~data~rate=2Hlog_2^V
$$
H是信道带宽，V是离散等级(二进制信号为2，四进制信号为4)



**香农定理**

有噪声信道的最大数据传输率

在带宽为H的有噪声信道中，信噪比为S/N

S是信号功率，N是噪声功率 
$$
Max~data~rate=Hlog_{2}^{1+\frac{S}{N}}
$$

$$
分贝:10log_{10}^{S/N}
$$

信噪比为一百，20分贝



### 引导性传输介质

#### 磁介质(Magnetic Media)

将数据从一台机器传输到另一台机器的最常见办法是将数据写到磁带或其他可擦写介质上(例如可刻录 DVD)，然后用物理的方法将磁带或者磁盘运送到目标机器，再将数据从磁带或磁盘里读出来。



从某种意义上，这样传输数据的带宽很高??

#### 双绞线(Twisted Pair)

双绞线由两根相互绝缘的铜线组成

why?

两根线绞在一起后，不同电线产生的干扰波就会相互抵消，从而显著降低电线的辐射



双绞线可以传输模拟信号，也可以用于传输数字信号



**双绞线分类**

- 3类线(Category 3)

- 5类线(Category 5)
- 6类线
- 7类线

五类线,四对双绞线套在一个塑料保护壳里



- UTP 非屏蔽双绞线
- STP 屏蔽双绞线

在每对双绞线外面加了一个屏蔽层，然后再整个线缆外面再加一个屏蔽层

屏蔽层能够减弱外部干扰和来自附近线缆的串扰

**一些术语**

`全双工链路`(full-deplex): 可以双向同时使用的链路

`半双工链路`(half-duplex):可以双向使用但一次只能使用一个方向的链路

`单工链路`(simplex)：只允许一个方向上传输的链路



#### 同轴电缆(Coaxial Cable)

两种广泛使用的同轴电缆：

- 基带(baseband)同轴电缆
  - 50Ω电缆– 数字传输
  - 75Ω电缆– 模拟传输

- 宽带(broadband)同轴电缆
  - 75Ω电缆-模拟传输、有线电视、多信道
  - 宽带网络：双电缆系统、单电缆系统



#### 光纤 Fiber Optics

**工作原理**：全内反射



光纤传输的三要素：

- 光源Light Source
- 传输介质：光纤
- 检测器Detector：光电二极管



**光缆**

- 单模光纤
- 多模光纤



#### 光纤和铜线的比较

光纤的优点：

- 带宽高、衰减小、抗干扰、轻、安全性高
- 几乎无线的带宽

光纤的缺点

- 技术陌生，容易损坏
- 全双工或半双工，取决于两端的接口设备
- 成本高





### 公共电话交换网络

#### 电话系统结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%AF%9D%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84.png)

a.全连通网络

b.中心交换网络

c.两层体系结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%AF%9D%E8%B7%AF%E7%94%B1.png)

每部电话机有两根铜线直接连接到电话公司最近的端局(end office),端局也叫做本地中心局。电话机与短句之间的双线连接在电话行业中称为**本地回路**(local loop)

电话系统由以下三个主要部分构成：

1. 本地回路(进入家庭和公司的模拟双绞线)
2. 中继线(连接交换局的数字光纤)
3. 交换局(电话呼叫在这里从一条中继线被介入另一条中间西安)



#### 本地回路：调制解调器、ADSL和光纤

##### 电话调制解调器

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%B0%83%E5%88%B6%E8%A7%A3%E8%B0%83%E5%99%A8.png)

要在本地回路或任何其他物理信道上发送比特，必须把比特转换为可在信道上传输的模拟信号。



调制解调器Modem：将数字信号转化为模拟信号

波特：每秒采样的次数

电话系统使用56kbps调制解调器,why?

- 电话信道4000Hz
- 重构信号所需的采样数是每秒8000次(根据奈奎斯特理论，只有采样频率高于原始信号最高频率的两倍时，才能把数字信号表示的信号还原成为原来信号)
- 在美国每个样本值为8比特，其中一位用作控制目的
- 7x8000=56000bit/s



编码解码器Codec：将模拟信号转化为数字吸纳后



##### 用户数字线

非对称数字用户线ADSL

使用离散多音调制的ADSL的分配

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/ADSL.png)

三个频带

信道0：用于简单老式电话服务(POTS,Plain Old Telephone Service)

信道1~5空闲，防止语音信号与数据信号相互干扰

剩下250条信道，一条用于上行流控制，另一条用于下行流控制，其他全部用于用户数据



ADSL标准:

- ANSI T.1413, ITU G.992.1
- 8Mbps Downstream
- 1Mbps Upstream



#### 中继和多路复用

##### 频分多路复用

FDM：Frequency Division Multiplexing

按频谱划分信道，不同频率的信号可以在同一信道内传输。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%A2%91%E5%88%86%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8.png)

**波分复用**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B3%A2%E5%88%86%E5%A4%8D%E7%94%A8.png)

WDM：Wavelength Division Multiplexing

按照波长划分信道

可以看作极高频的FDM



**时分复用**

一条物理信道按时间分成若干个时间片轮流地分配给多个信号使用

时分多路复用是将信道用于传输的时间划分为若干个时间片；

每个用户分得一个时间片；

在其占有的时间片内，用户使用通信信道的全部带宽。 



### 电路交换

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%B7%AF%E8%BF%9E%E6%8E%A5.png)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A22.png)



**包交换**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8C%85%E4%BA%A4%E6%8D%A2.png)

（非连接）路由器采用存储-转发技术，把经过它的每个数据包（根据网络线路、包的目的地址等条件）发送到通往该包目的地的路径上，没有固定的路径每个包都可以都不同的

路径，所以它们到达的顺序可能出现混乱。

出现的问题：排队延迟（queuing delay）：数据包可能会因为存在很多包要被转发而需要等待一段时间才能到它被转发，还可能引起拥塞



## 第三章 数据链路层

### 数据链路层的设计问题

数据链路层要使用物理层提供的服务在通信信道上发送和接收比特，它完成一些功能，包括：

1. 向网络层提供一个定义良好的服务接口
2. 处理传输错误
3. 调节数据流，确保慢速的接收方不会被快速的发送方淹没

为了实现这些目标,数据链路层从网络层获得数据包，然后将这些数据包封装成帧(frame)以便传输。每个帧包括一个帧头，一个有效载荷（净荷域），以及一个帧尾

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%B8%A7%E7%9A%84%E7%BB%93%E6%9E%84.png)

一个分组可能要分成多个帧



#### 提供给网络层的服务

最主要的服务是将数据从源机器的网络层传输到目标机器的网络层

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%9A%84%E6%9C%8D%E5%8A%A1.png)

三种可能的服务:

- 无确认的无连接服务

源机器向目标机器发送独立的帧，目标机器不对这些帧进行确认。不需建立逻辑连接。适用于错误率低或者实时通信（语音传输）的情况

- 有确认的无连接服务

源机器向目标机器发送独立的帧，目标机器会对这些帧进行确认。不需建立逻辑连接。适用于不可靠的信道（无线系统，WiFi）。

- 有确认的有连接服务

源机器和目标机器在传输任何一个数据之前要建立一个连接，保证目标机器按照正确的顺序接受每一个帧。适用于长距离且不可靠的链路（卫星信道，长途电话）。



#### 成帧 framing

解决两个问题：

- 帧的边界问题
- 帧的透明传输（透明）问题



四种成帧方法:

1. 字符计数法 Character count 

用头部的一个字段来标识该帧中的字符数

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%AD%97%E7%AC%A6%E8%AE%A1%E6%95%B0%E6%B3%95.png)

问题：一旦出现传输错误，就会导致后续混乱

2. 含字节填充的分界符法 Flag Bytes with byte stuffing

发送方使用标志字节（FLAG）作为开始和结束；使用转义字节（ESC）表示其后的字节为数据字节而不是标志字节或转义字节。接收方将收到的数据中的转义字节删除后再传递给网络层

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%88%86%E7%95%8C%E7%AC%A6%E6%B3%95.png)

3. 含位填充的首尾界符法Starting and ending flags,with bit stuffing

使用“01111110”表示帧的开始和结束（帧的边界问题解决）

若遇到 5 个连续的比特 1，就在其后填入一个比特 0（帧的填充问题解决）

接收方除了将首尾的“01111110”删除外，还要将数据中所有 5 个连续比特 1 其后的比特 0 删除。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%90%AB%E4%BD%8D%E5%A1%AB%E5%85%85%E7%9A%84%E9%A6%96%E4%BD%8D%E7%95%8C%E7%AC%A6%E6%B3%95.png)

4. 物理层编码违禁法 Physical layer coding violation

Bit “1”  高-低电平对

Bit “0”  低-高电平对

帧的边界（高-高，低-低）



#### 差错控制

为确保所有帧按照正确顺序传递给目标机器的网络层：

发送方发送反馈信息来确保传递可靠。

引入计时器来防止硬件故障或通信信道出错等原因丢失某一帧使发送方持续等待确认。

通过序号保证每一帧按照顺序且不会被接收方重复接收。

具体的确认方式在后面通过协议的形式来讲



#### 流量控制

发送方发送帧的速度超过了接收方能够接收这些帧的速度，而导致丢帧。

解决方法：

基于反馈的流量控制（链路层）。

基于速率的流量控制（网络层）。



### 差错检测和纠正

#### 纠错码



推断出发送的数据是什么，适用于错误发生很频繁的信道。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B5%B7%E6%98%8E%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90.png)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%B5%B7%E6%98%8E%E7%A0%81%E7%9A%84%E6%8E%A5%E6%94%B6.png)

#### 检错码

检测d比特错需距离为d+1比特的编码

推断是否发生错误。适用于高度可靠的信道，错误偶尔发生时，只需重传整个数据块即可。循环冗余校验码（CRC,Cyclic Redundancy Check，也称作多项式编码）。注意有一定的误判率。

步骤：

1. 收发双方商定一个比帧短且头尾都是 1 的 01 串叫做生成多项式
2. 帧的后面附上生成多项式长度减一个 0 后，作为被除数对生成多项式模2除，得到商和余数

3. 若帧与余数合并以后在接收方被生成多项式整除，那么认为传递的过程没有出错



在接收端，再次进行同样的除法运算

只要得出的余数 R 不为 0，就表示检测到了差错

一旦检测出差错，就丢弃这个出现差错的帧



### 基本数据链路层协议

#### 实用的停等协议

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%AE%9E%E7%94%A8%E7%9A%84%E5%81%9C%E7%AD%89%E5%8D%8F%E8%AE%AE.png)



组成帧的四个字段：kind、seq、ack 和 info。前三个包含控制信息，称为帧头，最后一个可能包含了要被传输的实际数据。

**一种无限制的单工协议**(乌托邦式的单工协议)

假设

- 数据只能单向传输
- 数据链路层之间的通信信道永远不会损坏或者丢失帧
- 两端的网络层就绪
- 处理时间忽略
- 缓冲区空间 无穷大   

这是一个完全不现实（理想化）的协议，“乌托邦” 协议。

发送过程是一个无限的 while 循环，它尽可能快速地把数据放到线路上。无差错控制

或者流量控制方面的限制。接受过程一直等待一个未损坏的帧到达。（发送速率和接收速率

必须一样快



**无错信道上的单工停-等式协议**

假设：

- 单向数据传输发送方
- 网络层一直有无限的数据要发送 
- 信道不会出错，从不损坏或丢失帧

接收方发送一个响应帧，通知发送方发送下一帧

如果接收方不反馈应答信号，则发送方必须一直等待，然后就陷入等待接收方确认信息的过程中，因而传输效率低。



**有错信道上的单工停-等式协议**

- 信道有噪声
- 需要计时器与序号配合，需要超时重传机制



肯定确认的重传协议(Positive Acknowledgement with Retransmission)ACK

自动重传协议(ARQ)



#### 停等协议的要点

- 实用的 CRC 检验器都是用硬件完成的
- CRC检验器能够自动丢弃检测到的出错帧。因此所谓的“丢弃出错帧”，对上层软件或用户来说都是感觉不到的。
- 发送端对出错的数据帧进行重传是自动进行的，因而这种差错控制体制常简称为 ARQ (Automatic Repeat reQuest)，直译是自动重传请求，但意思是自动请求重传。



#### 停等协议的效率问题

- 信道利用率很低

- 一种提高效率的方法：使用更大的帧

可以使用更大的帧，但是帧的最大长度受到信道比特错误率（BER，Bit Error Ratio）的限制，帧越大，在传输中出错的概率越高，将导致更多的重传



### 滑动窗口协议

#### 基本概念

**捎带确认**(piggybacking)：暂时延缓确认以便将确认信息搭载在下一个出境数据帧上的技术。捎带确认通常与累计确认一同使用，更好的利用了信道的可用带宽。

**期望确认**:收到数据帧以后向发送方发送期望对方发送的下一帧的序号

**累计确认**（cumulative acknowledgement）：当 n 号帧的确认到达,n-1号帧、n-2号帧等都会自动被确认。

**否定确认**(NAK)：接收方检测到错误时发送的否定确认，实际是一个重传请求，在NAK中指定了要重传的帧

**发送窗口**(sending window)：发送方总维持着一组序号，分别对应于允许它发送的帧，我们称这些帧落在发送窗口。

**接收窗口**(receiving window):接收方维持着的一个窗口对应于一组允许它接受的帧



#### 一位滑动窗口协议

发送窗口大小=1，接收窗口大小=1,可保证帧的有序接收，但效率较低。

源站发送单个帧后必须等待确认，在目的站的确认到达源站之前，源站不能发送其他数据帧。这是因为发送窗口大小仅为 1，必须用来保存当前未确认的帧以超时重传。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1%E4%BD%8D%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E5%8D%8F%E8%AE%AE.png)

#### 回退N协议

发送窗口大小>1，接收窗口大小=1

发送方按照顺序向对方发送帧，在收到对方的确认以后窗口向后滑动，若当前窗口中的第一个帧出现超时，那么回退到这个帧重新发送所有的帧。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9B%9E%E9%80%80N%E5%8D%8F%E8%AE%AE.png)

而因为接收窗口大小为 1，除了数据链路层必须要递交给网络层的下一帧外，接收方拒绝接受任何帧。如果在计时器超时以前，发送方的窗口已被填满，则管道将变为空闲，最终，发送方将超时，并且按照顺序重传所有未被确认的帧，从那个受损或者丢失的帧开始。

一般使用累计确认



#### 选择重传协议

**发送方**

发送窗口大小$W_T$的取值范围是
$$
1< W_r\le 2^{n-1}
$$
其中，n是构成分组序号的比特数量

$W_r=1$与停-等协议相同

$W_r>2^{n-1}$ 接收方无法辨别新、旧数据分组



发送方可在未收到接收方确认分组的情况下，将序号落在发送窗口内的多个数据分组全部发送出去;



发送方只有按序收到对已发送数据分组的确认时，发送窗口才能向前相应滑动;若收到未按序到达的确认分组时，对其进行记录，以防止其相应数据分组的超时重发，但发送窗口不能向前滑动。

**接收方**

接收窗口尺寸$W_R$的取值范围
$$
1<W_R\le W_T
$$
$W_R=1$ 与停-等协议相同

$W_R>W_T$ 无意义

接收方可接收未按序到达但没有误码并且序号落在接收窗口内的数据分组;
为了使发送方仅重传出现差错的分组，接收方不能再采用累积确认，而需要对每个正确接收到的数据分组进行逐一确认!



接收方只有在按序接收数据分组后，接收窗口才能向前相应滑动。



## 第四章介质访问控制子层

### 多路访问协议



#### ALOHA

##### 纯ALOHA

基本思想：当用户有数据需要发送时就传输,如果发生冲突，则等待随机时间后，重发数据

在ALOHA系统，采用统一帧长比长度可变帧能达到更大的吞吐量



`帧时`标识传输一个标准的、固定长度的帧所需的时间


$$
S=G*e^{-2G}
$$
S:每帧时成功传输的帧数量,S$\le$1

G:每帧时的平均帧数为G

当G=0.5时，S值最大，为0.184

换句话说，信道的最好利用率为18%



##### 分槽ALOHA

将时间分成离散的间隔，这种时间间隔称为`时间槽`(slot),每个时间槽对应一帧。

用户遵守统一的时间槽边界,只有在槽的开始时刻才能发送帧
$$
S=G*e^{-G}
$$
G=1时，S取得最大值0.368

也就是说，理想状态下，信道的最好利用率为36%



#### CSMA载波监听多路访问协议

基本思想：检测其他站点，调整自己的动作，大大提高利用率



- 1-persistent CSMA

如果信道忙，则站点持续等待，直到信道空闲

如果空闲，站点立刻传输数据

如果冲突发生，站点等待随机一段时间后

- Nonpersistent CSMA

如果信道忙，等待一段时间

如果空闲，站点立即传输数据

信道利用率比1-persistent高，但是又更高的延迟

- p-persistent CSMA

如果信道繁忙，站点会连续检测介质

如果信道空闲，则它以概率p发送数据，以概率1-p将此次发送推迟到下一个时间槽

如果冲突发生，站点会等待一段随机时间

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/CSMA.png)

二进制指数后退算法

在i次冲突后，随机数在0~$2^i-1$这个范围内选取

在16次冲突后，控制器放弃并向计算机报告故障。

- 带冲突检测的CSMA CSMA/CD

如果两个站帧听到信道为空，并且同时开始传输，则它们的信号仍然会产生冲突。因此，另一个改进是每个站快速检测到发生冲突后立即停止传输帧

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/CSMA%20CD.png)

CSMA/CD模型由交替出现的**竞争期**、**传输期**，以及当所有站都静止的**空闲期**组成

假设两根相距最远的站传播信号所需要的时间为t,那么冲突检测的最长时间为2t



使用CSMA/CD协议的单信道网络不能进行全双工通信，只能进行半双工通信



以太网的端到端往返时延2t称为争用期，或碰撞窗口



以太网的最小帧长为64字节,凡小于64字节的帧都是由于冲突而异常终止的无效帧



CSMD/CD优缺点：

- 原理简单、技术上易实现，网络中各工作站处于平等地位，不需要集中控制，不提供优先级控制
- 网络负载增大时，发送时间增长，发送效率急剧下降



### 无冲突的协议

#### 基本位图法

每个竞争期包含N个槽，i号站通过在i号槽中插入1位来声明自己由帧要发送，当N个槽经过后，每个站都知道了哪些站希望发送数据，这时候，按照数字顺序开始传送数据

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E6%9C%AC%E4%BD%8D%E5%9B%BE%E5%8D%8F%E8%AE%AE.png)

效率=d/(N+d) 

N-每帧的开销，d-数据量/帧

高负荷下，效率=d/(d+1) (N=1)





#### 有限竞争协议

竞争法（如CSMA)和无冲突法的结合

低负荷时，采用竞争法，使时延较短

重负荷时，采用无冲突法，使信道利用率较高



### 以太网

在局域网中，硬件地址又称为物理地址，或MAC地址

消息的发送使用曼彻斯特编码,**实现对通信过程中收发双发的数据同步**

每一位的中间有一跳变，位中间的跳变既作时钟信号，又作数据信号

接收方利用包含有同步信号的特殊编码从信号自身提取同步信号来锁定自己的时钟脉冲频率，达到同步目的

每一个码元都被调成两个电平，所以数据传输速率只有调制速率的1/2



**两种重要措施**

- 无连接的工作方式，不必先建立连接就可以直接发送数据
- 以太网对发送的数据帧不进行编号，也不要求对方发回确认

why？局域网信道质量很好，由信道质量产生差错的概率时很小的



**以太网提供的服务**

不可靠的传输服务

当目的站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。

如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送。 



**两个标准**

- DIX Ethernet V2

- IEEE 802.3



#### 以太网MAC子层协议

##### 以太网帧结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E7%BB%93%E6%9E%84.png)

最常用的MAC帧是以太网V2的格式。

Destination address 目的地址

Source address 源地址

Type类型 用来标志上一层使用的是什么协议，以便把收到的MAC帧数据上交给上一层的这个协议

数据字段最小长度=64B-18B=46字节

当数据字段长度小于46字节时，要填充整数字节的填充字段，以保证以太网的MAC帧长不小于64字节

FCS字段通常用于错误检测,通过计算数据帧中的校验和,可以判断数据在传输过程中是否发生了错误

 

为了达到比特同步，在传输媒体上实际传送的要比MAC帧还多8个字节

Preamble 7字节 前同步码 1字节 帧开始定界符



**无效的MAC帧**

- 数据字段的长度与长度字段的值不一致
- 帧的长度不是整数个字节
- 用收到的帧检验序列 FCS 查出有差错
- 数据字段的长度不在 46 ~ 1500 字节之间
- 有效的 MAC 帧长度为 64 ~ 1518 字节之间



对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。 



#### 交换式以太网

以交换机为核心设备而建立起来的一种高速网络。可在高速与低速网络间转换，实现不同网络的协同。交换机分割了连接的不同网络成为不同的冲突域，不同冲突域之间信号不会彼此干扰，所以不用考虑不同自治域间的冲突问题。



#### IEEE 802.2: Logical Link Control 逻辑链路控制子层

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关，不管采用何种协议的局域网对 LLC 子层来说都是透明的 



一般不考虑LLC子层

TCP/IP 体系经常使用的局域网是 DIX Ethernet V2 而不是 802.3 标准中的几种局域网



### 无线局域网协议

**无线局域网CSMA**

- 隐蔽站问题

无线节点没能检测出信道上已经存在的信号而导致冲突发生

- 暴露站问题

在WLAN中,在不发生干扰的前提下允许多个节点进行通信,因检测出信道上已经存在的信号而放弃无冲突的通信

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%9A%90%E8%97%8F%E7%AB%99%E5%92%8C%E6%9A%B4%E9%9C%B2%E7%AB%99%E9%97%AE%E9%A2%98.png)

关键问题：开始一个传输之前，一个站真正希望知道的是接收方的周围是否有活动情况

**MACA冲突避免多路访问协议**

也叫CSMA/CA

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%86%B2%E7%AA%81%E9%81%BF%E5%85%8D%E5%A4%9A%E8%B7%AF%E8%AE%BF%E9%97%AE%E5%8D%8F%E8%AE%AE.png)

**RTS(Request To Send)和CTS(Clear To Send)**协议

1. A首先给B发送一个RTS帧，这个短帧包含了随后将要发送的数据帧的长度

2. B用一个CTS帧作为应答，该帧也包含了数据长度(RTS复制过来)，A在收到CTS帧之后便开始传输

3. 如果其他站听到了RTS帧，那么它一定离A很近，它必须保持沉默，至少等待足够长的时间以便在无冲突的情况下CTS返回给A

4. 如果一个站听到了CTS，则它一定离B很近，在接下来的数据传送过程中它必须一直保持沉默，只要检查 CTS帧，该站就可以知道数据帧的长度(即数据传输要持续多久)。

冲突仍有可能发生，如B和C同时给A发送RTS，发生冲突的情况下，不成功的发送方将随机等待一段时间后再重试



### 无线局域网

#### 802.11体系结构和协议栈

##### 802.11体系结构

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%20%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png)

a. 有架构模式，每个客户端与一个接入点AP关联，该接入点又与其他网络连接，客服端发送和接收数据包都要通过AP进行。几个接入点可通过一个称为分布式系统的有线网络连接在一起，形成一个扩展的802.11网络

b. 自组织网络。这种模式下的网络由一组互相关联的计算机组成，它们相互之间可以直接向对方发送帧，没有接入点。

##### 802.11协议栈

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%E5%8D%8F%E8%AE%AE%E6%A0%88.png)

介质访问控制子层MAC决定如何分配信道

逻辑链路控制子层LLC，隐藏802.11系列协议之间的差异，使它们在网络层看来并无区别



#### 802.11 MAC子层协议

802.11采用带有冲突避免的CSMA

两种操作模式：

DCF：分布式协调功能，不含中心控制

PCF：点协调功能，使用AP控制自己覆盖范围内的一切活动，就像蜂窝通信中的基站一样

必须支持DCF,PCF是可选的



##### DCF

**CSMA/CA**（CSMA with Collision Avoidence)

采用DCF，同时使用物理和虚拟信道感知

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%8F%91%E9%80%81%E5%B8%A7.png)

方法1：侦听信道，如果空闲，就开始传输。如果发生冲突，等待随机时间，采用以太网二进制扩展回退算法，直到成功发送帧或达到重传的最大次数

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BD%BF%E7%94%A8CSMA%20CA%E7%9A%84%E8%99%9A%E6%8B%9F%E4%BF%A1%E9%81%93%E4%BE%A6%E5%90%AC.png)

方式2：基于MACA，使用虚拟信道侦听

NAV Network Allocation Vector，每个帧携带一个NAV字段，说明这个帧所属的一系列数据将传输多长时间

A给B发送一个RTS帧，请求对方允许自己发送一个帧给它。

B接收到这个请求，以CTS帧作为应答，表名信道被清除可以发送

A收到CTS帧，发送数据帧，启动一个ACK计时器，当正确的数据帧到达后，B使用一个ACK帧回复A，完成这次交流

如果A的ACK计数器超时，可视为发生了一个冲突，经过一次后退，协议重写开始运行



从C和D的角度看，C在A的范围内，可能会收到RTS帧，如果收到，则从RTS帧提供的信息，可以估算出数据序列将需要传输多长时间，通过更新自己的NAV表明信道正忙，B收到CTS，也更新NAV，NAV信号不传输，只是站内部使用，提醒自己保留一定时间内的安静

这个过程叫做断言NAV



##### PCF模式：轮询，无冲突

- 基站AP定期广播信标帧,该帧通告客户端AP的存在，同时传递一些系统参数

- 电源管理：客户端告诉基站进入省电模式



##### **PCF和DCF共存**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%E5%B8%A7%E9%97%B4%E9%97%B4%E9%9A%94.png)

- DIFS（DCF InterFrame Spacing）DCF帧间隔

任何站都可以在介质空闲DIFS后尝试抓取信道发送一个新帧

- SIFS (Short InterFrame Spacing) 短帧间间隔

允许一次对话的双方具有优先抓住信道的机会

- AIFS (Arbitration InterFrame Space) 仲裁帧间空间 显示了两个不同优先级的例子
  - AIFS1小于DIFS大于SIFS，被AP用来语音或其他高优先级流量移到行头，AP将等待一段较短的时间间隔，然后发送语音流量，这样语音流量得以在常规流量之前发送出去
  - AIFS4大于DIFS，用来发送可以延迟到常规流量后发送的背景流量
- EIFS (Extended InterFrame Spacing)

仅用于一个站刚刚收到坏帧或未知帧后报告问题



#### 802.11 帧结构

**数据帧格式**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/802.11%20%E5%B8%A7%E7%BB%93%E6%9E%84.png)

**FrameControl帧控制字段(11个子字段)**

- Version 协议版本
- Type (数据帧、控制帧、管理帧)
- SubType (RTS CTS ACK)
- To DS 发送到与AP连接的网络
- From DS 来自AP连接的网络
- More fragment 意味后面还有更多的段
- Retry (重传) 表明这是以前发送的某一帧的重传
- Power management 标志位表明发送方进去节能模式
- more data 表明发送方还有更多的帧需要发送给接收方
- Protected  帧的帧体已被加密
- Order 告诉接收方高层希望严格按照顺序来处理帧序列

**Duration 持续时间字段**

告知本帧和其确认帧将会占用信道多少时间，按微秒计算，该字段会出现在所有帧中，包括控制帧，其他站用该字段来管理各自的NAV机制

**地址字段**

发往AP或者从AP接收的帧都具有三个地址，接收方地址、发送方地址

远程端点地址

当在一个客户端和网络中另一点之间传输时，AP 只是一个简单的中继点。这网络中的另一点也许是一个远程客户端，或许是 Intermet 接入点。第三个地址就指明了这个远程端点。

**Sequence字段**

帧的编号，可用于重复帧的检测 16位，4位段号 12位帧号，每发出一帧数字递减

**Data字段**

包含了有效载荷，最长2312字节

**Check Sequence 帧校验序列字段**

32位CRC



**管理帧**

管理帧格式和数据帧格式相似，没有基站地址，管理帧只在一个单元内有用

**控制帧**

控制帧更短，具有帧控制字段、持续时间字段和帧校验序列字段，只有一个或两根地址，没有数据字段，没有序列 字段大多数关键信息都转换为Subtype字段（RTS ,CTS ,ACK）



### 数据链路层交换

局域网可以被一个叫做`网桥`的设备连接起来

网桥在数据链路层工作，通过检查数据链路层地址来转发帧

可以处理IP数据包，也可以处理其他类型的数据包(AppleTalk包等)

`路由器`检查数据包的地址，并基于这些地址路由数据包，只能以预先设计好的协议工作



#### 学习网桥

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%B1%80%E5%9F%9F%E7%BD%91%E7%BD%91%E6%A1%A5%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84.png)

站和集线器都能与之相连，如果LAN技术是以太网，则网桥就是以太网交换机，网桥统一端口的站都属于同一个冲突与，如果存在多个站，那么帧的发送需要CSMA/CD协议

工作原理
网桥工作在数据链路层，将多个 LAN 连接起来，通过检查数据链路层地址来转发帧。
①当一帧到达时，网桥必须决定是将该帧转发还是丢弃

②如果决定转发，还必须要决定在哪个端口传输帧

③网桥通过在其内部配备一个大的(哈希)表来查询一帧的目的地址，该表中列出了每一个可能的目的地址以及它隶属的输出端口
④当网桥第一次被接入网络时,所有的哈希表都是空的,网桥使用洪泛算法完善哈希表。

⑤其具体转发过程为:
a.目的地址的端口与源端口相同，则丢弃该帧
b.目的地址的端口与源端口不同，则转发该帧到目的端口
c.目标地址端口未知，则使用洪泛算法，将帧发送到所有的端口，除了他入境的那个。



**泛洪算法**

对于每个发向未知目标地址的入境帧，网桥将它输出到所有的端口，但它来的那个输入端口除外。随着时间的推移，网桥将会学习到每个目标地址在那里。一旦知道了一个目标地址，以后发给该地址的帧只被放到正确的端口，而不再被泛洪到所有端口。

**后向学习法（backward learning）**

正如上面所提到的，网桥工作在混杂模式下，所以，它们可以看得到每个端口上发送的所有帧。通过检查这些帧的源地址，网桥就可获知通过那个端口能访问到哪些机器。

#### 生成树网桥

为了提高可靠性，网桥之间可以使用冗余链路

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%86%97%E4%BD%99%E9%93%BE%E8%B7%AF%E7%BD%91%E6%A1%A5.png)

引入额外的问题：生成了拓扑环路

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%9F%E6%88%90%E6%A0%91.png)

 将拓扑结构抽象为图，网桥为结点，点到点链路为边。通过去掉一些链路，整个图被简化为一棵生成树，一旦网桥同意这颗生成树，则站之间的所有转发都将沿着这棵树进行，进而解决了环路的问题



网桥标识符：基于MAC地址，全世界独一无二



生成树算法执行过程：

1. 选择网桥标识符最小的网桥作为生成树的根
2. 构造从根到每个网络的最短路径树（最短路径一般以跳数为衡量），如果到达两个网桥的跳数相等，则选择经过网桥标识符较小的网桥的路径
3. 网桥关闭哪些不属于最短路径一部分的端口

4. 在网络正常操作期间该算法也要继续运行，以便自动检测拓扑结构的变化，以生成新树



#### 网桥扩展局域网(补充)

**网桥**

- 工作在链路层，知道MAC帧结构
- 根据MAC帧的目的地址对收到的帧进行转发。当一个单播帧到达时，网桥并不是向所有的端口转发此帧，而是先检查其目的MAC地址，然后再确定将该帧转发到哪一个端口。
- 当一个广播帧到达时，网桥向所有的端口转发此帧
- 网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会产生较大的广播风暴。（路由器可以阻断广播风暴）

- 站表（转发表）与路由表不同，其目的地址是MAC地址，后者的目的地址是IP地址。

**透明网桥**

- IEEE 802.1D或ISO 8802.1D标准。
- 混杂接收方式（Promiscuous):所有帧统统收进。
- 网桥每收到一个帧，就在站表中登记以下三个信息（如果站地址及端口已登记，则仅修改时间）,逆向学习法：
  - 站地址  登记收到的帧的源MAC地址
  - 端口  登记收到的帧进入该网桥的端口号。
  - 时间  登记收到的帧进入该网桥的时间
- 到达帧的路径选择：
  - 源LAN和目的LAN相同(即端口相同）,则丢弃该帧
  - 源LAN和目的LAN不同(即端口不同）,则转发该帧
  - 目的LAN未知,则进行广播
  - 目的地址为广播地址，则进行广播



`远程网桥`可用于连接远程局域网。



#### 中继器/集线器/网桥/交换机/路由器和网关

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%BE%E5%A4%87%E5%B7%A5%E4%BD%9C%E5%B1%82%E6%AC%A1.png)

这些设备工作在不同的层，通过不同的信息决定如何转发信息



Repeater中继器：用于放大信号，不理解帧、数据包或帧头。只理解伏特

Hub 集线器：不放大信号，不理解MAC地址，整个集线器形成一个冲突域

Bridges 网桥：连接局域网，根据帧地址路由，每个端口被隔离成它自己的一个冲突域，如果端口是全双工的点到点线路，则需要用到CSMA/CD算法

Switches 交换机：连接独立的计算机，连接单个计算机，按帧地址路由，不会因冲突而丢失帧

传输网关:连接使用不同面向连接的传输协议的两台计算机

应用网关:理解数据的格式和内容，并将消息从一种格式转换为另一种格式。例如电子邮件网关。

Router 路由器在下面的章节介绍

#### 虚拟局域网

为什么局域网按照逻辑而不是物理配置局域网：

- 安全（避免信息通过Web服务器泄露）
- 负载（某些LAN比其他LAN具有更重的负载，需要将它们隔离开）
- 广播风暴（一旦网络接口崩溃或被错误配置，会产生无休止的广播帧流）



虚拟局域网VLAN 基于特殊设计的VLAN感知（VLAN-aware)交换机

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/VLAN.png)

为了使VLAN正常地运行，网桥必须建立配置表，指明通过哪些端口可以访问到哪些VLAN，一个端口可以被标记为多种VLAN颜色

网桥和交换机如何知道传入的帧是什么颜色？

每个端口都分配一个VLAN颜色（可以标记为多个VLAN颜色）

仅当端口上的所有计算机属于同一个VLAN时才起作用

每个MAC地址被分配一个VLAN颜色

有一个表格列出每台与它关联的机器的48位MAC地址以及机器所在的VLAN。

每一个第3层协议或IP地址都被分配一个VLAN颜色。
用于网桥或交换机检查帧的有效负载字段问题

它违反了网络最基本的规则:层的独立性



 **IEEE 802.1Q标准**

VLAN字段实际上只被网桥和交换机使用，而不被用户机器使用



## 第五章 网络层

网络层关注的是如何将源端数据包一路送到接收方，网络层是处理端到端通信的最底层

网络层必须知道网络拓扑结构，并且从中选择出适当的路径

### 网络层设计问题

#### 存储转发数据包

如果一个主机想要发送一个数据包，它就将数据包传送给最近的路由器。该数据包到达路由器，并且路由器的链路层完成了对它的校验和的验证后，它先被存储在路由器上，然后沿着路径被转发到下一个路由器，直至到达目标主机，这种机制即为`存储-转发机制`



#### 提供给传输层的服务

网络层通过网络层/传输层接口向传输层提供服务,在设计网络层服务时，需牢记以下目标

- 向上提供的服务应该独立于路由器技术
- 应该向传输层屏蔽路由器的数量，类型和拓扑关系
- 传输层可用的网络地址应该有一个统一的编制方案，甚至可以跨越LAN和WAN



两种服务

- 无连接的服务
- 面向连接的服务



#### 无连接服务的实现

无连接的服务，所有的数据包都被独立地注入网络中，每个数据包独立路由，不需要提前建立任何设置。

数据包通常称为`数据报`(datagram)

对应的网络叫做`数据包网络`(datagram network)



**IP协议**(Internet Protocal)是整个Internet的基础，无连接网络的重要范例

每个数据包携带一个目标IP地址，路由器用该地址来单独转发每一个数据包，IPv4数据包的地址是32位的，IPv6是128位的





#### 面向连接服务的实现

面向连接的服务需要虚电路网络

建立一个连接时，从原机器到目的机器之间的一条路径就被当做这个连接的一部分确定了下来，并保存在这些中间路由器的表中

面向连接的服务中，每个数据包包含一个标识符，指明它属于哪一条虚电路

`标签交换`

为不同连接的出境流量分配一个不同的连接标识符，从而避免冲突，路由器需要具备替换出境路由器中连接标识符的能力



### $\star$路由算法

路由算法是网络层软件的一部分，它负责确定一个入境数据包应该被发送到哪一条输出线路上

**两类路由算法**

- 非自适应算法(静态路由)：不会根据当前测量或估计的流量和拓扑结构来调整它们的路由决策

- 自适应算法(动态路由)：会改变它们的路由决策以便反应出拓扑结构的变化，通常也会反映出流量的变化情况



#### 优化原则

**最优化原则**

如果路由器J在从路由器I到路由器K的最优路径上，那么J到K的最优路径也必定遵守同样的路由

最优化原则的一个直接结果：所有的源到一个指定目标的最优路径的集合构成了一棵以目标节点为根的树，称为`汇集树`(sink tree)

汇集树不是唯一的，汇集树不一定存在

路由算法的目标是为所有的路由器找到并使用汇集树



#### 最短路径算法

测量路径长度的依据：

- 站点数量
- 举例
- 信道带宽
- 平均通信量
- 通信开销

etc.

使用dijkstra算法计算最短路径



#### 泛洪算法

在实现路由算法时，每个路由器必须根据本地知识而不是网络的全貌做决策(最短路径算法不适用的原因)

**泛洪**(flooding) 这种技术将每一个入境数据包发送到除了该数据包到达的那条线路意外的每条出境线路



问题：泛洪会产生大量的重复数据包

如何解决？ 

- 在每个数据包的头中设计一个跳计数器，每经过一跳，计数器减一，当计数器到达0时，丢弃该数据包

理想情况下：跳计数器初始值是从源端到接收方的路径长度，最坏情况下，为网络的直径

- 让路由器跟踪已经泛洪过的数据包，从而避免第二次发送它们（为每个源路由器提供一张表，记录来自源路由表的数据包的序号）



#### 距离矢量路由

每个路由器维护一张表，表中列出了当前已知的到每个目标的最佳距离（表有两列，延迟和线路），以及使用的链路

也叫Bellman-Ford路由算法，RIP协议(ARPANET)

每个路由器经过一个时间间隔，就像它的每个邻居发送一个列表，包含了它到每个目标的延迟估计值，同时也收到了从每个邻居的类似的表，然后更新延迟



**无穷计数问题**

整个网络最佳路径的寻找过程称为**收敛**(convergence)。距离矢量路由算法坏消息的反映异常迟缓

如何解决无穷计数问题？

1. 设置最大跳数（16跳不可达）
2. 水平分割 （从一个接口学来的路由不会从该接口发回去）当存在环路时，这个方法无效
3. 毒化路由：当一个路由器无法访问时，告知邻居，邻居再告知邻居，以此类推



#### 链路状态路由

IS-IS OSPF 已经成为应用最广泛的路由算法

1. 发现它的邻居节点，并了解其网络地址
2. 设置到每个邻居节点的距离或者成本度量值
3. 构造一个包含所有刚刚获知的链路信息包
4. 将这个包发送给所有其他的路由器，并接收来自所有其他路由器的信息包
5. 计算出到每个其他路由器的最短路径

原理：算法将完整的拓扑结构分发给了每一个路由器，然后每个路由器运行Dijkstra算法就可以找出从本地到每一个其他路由器的最短路径



**发现邻居**

路由器启动时，在每一条点到点链路上发送一个特殊的HELLO数据包。线路另一端的路由器应该返回一个应答说明自己是谁，这些名字必须是全局唯一的。



当两个或多个路由器通过一个广播链路连接(交换机、环或经典以太网),把这个链路看作一个特殊的人造节点N，它与广播链路上的路由器相连，LAN上的一个指定路由器被选中代替人造节点N运行路由协议



**设置链路成本**

一种常用的选择是使成本和链路带宽成反比



如果网络在地理上分散，链路延迟可以作为成本的组成部分

如何确定延迟？通过线路给另一边发送一个特殊的ECHO数据包，要求对方立即发回，通过测量往返时间除以2，发送路由器就可以得到一个合理的延迟估算值



**构造链路状态包**

该数据包的内容是发送方的标识符，接着是一个序号(Seq)和年龄(Age)，以及邻居列表。对于每个邻居，同时要给出到这个邻居的延迟

何时构造数据包?

- 周期性地创建数据包
- 发生某些重要的事情时才创建数据包

**分发链路状态包**

基本思路：使用泛洪法将链路状态数据包分发给所有路由器

为了控制泛洪规模，路由器记下所有到达的(源路由器、序号)对

当一个新的链路数据包到达时，路由器检查新来的数据包是否已经出现在上述的列表中，如果是一个新的数据包，则将它转发到除入境线路之外的所有其他线路上，如果是一个重复数据包，或者数据包序号小于当前看到的来自该源路由器的最大序列号(当作过时数据包)，则丢弃

- ==新数据包转发==
- ==重复数据包、过时数据包丢弃==



问题：

1. 序号绕回可能会产生混淆 

使用32位序号

2. 路由器崩溃，丢失所有路由表，序号从0开始，下一个数据包被作为重复数据包而拒绝
3. 序号被破坏，导致后续数据包被当作过时数据包被拒绝接受

每个数据包的序号后都包含一个年龄(Age)字段，并且每秒钟将年龄-1，当年龄字段值被减到0时，来自路由器的该信息被丢弃



算法改进

当一个链路状态数据包被泛洪到一个路由器时,首==先被放到一个保留区中等待一段时间==。在这个数据包被转发出去之前，另一个来自于同一个源路由器的链路状态数据包也到来了，那么就比较它们的序号。如果两个数据包的序号相等，则丢弃重复数据包。如果两者不相等，则丢弃老的数据包。==为了防止线路产生错误导致丢包和错包，所有的链路状态数据包都要被确认==。

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E5%99%A8B%E7%9A%84%E7%8A%B6%E6%80%81%E5%8C%85%E7%BC%93%E5%86%B2%E5%8C%BA.png)

**计算新路由**

使用dijkstra算法计算最短路径

应用:

- IS-IS 中间系统到中间系统

- OSPF 开放最短路径优先

IS-IS 和 OSPF 之间的差异非常小。其中一个最重要的差别是，IS-IS 可同时携带多个网络层协议的信息(比如，IP、IPX和 AppleTalk)，OSPF 不具备这个特性。



#### 分层路由

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%88%86%E5%B1%82%E8%B7%AF%E7%94%B1.png)

代价：增加了路径长度



#### 广播路由

1. **原机器简单地给每一个目标单独发送一个数据包**

浪费带宽，且要求源机器到目标机器的完整地址

2. **多目标路由**

每个数据包包含一组目标地址，或者一个位图，由该位图指定所期望到达的目标。当一个数据包到达路由器时，路由器检查数据包携带的所有目标，决定哪些输出线路是必要的，并为每一个输出线路生成一个数据包副本，副本中只包含那些使用这条线路的目标地址

到最后，每个数据包将只包含一个目标地址

优点：当多个数据包必须遵守相同的路径时，一个数据包承当了所有的费用

其他数据包免费搭载，==网络带宽利用率更高==

缺点：需要源端知道全部的目标地址，对路由器来说，要确定从那些线路转发多目标数据包工作量太大

3. **泛洪**

要求：每个源实现信号

4. **逆向路径转发**

当一个广播数据包到达一个路由器时，路由器检查它到来的那条路线是否时通常用来给广播源端发送数据包用的哪条线路，如果是，则该广播数据包时沿着最佳路径被转发过来的，是到达当前路由器的第一份副本，路由器将该数据包转发到除了到达的那条线路的其他线路上

如果广播数据包是从其他任何一条非首选的到达广播源的线路入境的话，该数据包可能被当作一个重复的数据包丢弃

优点：有效且易于实现，仅仅要求路由器知道如何到达全部目标，无需实现序号

5. **生成树 或 汇集树**

生成树是网络的一个自己，它包含所有的路由器，但是没有任何环路。汇集树是生成树的一种，如果每个路由器都知道它的哪些线路属于生成树，那么他就可以将一个广播入境数据包复制到除了该数据包到来的那条线路之外的所有生成树线路上



#### 组播路由

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BB%84%E6%92%AD%E8%B7%AF%E7%94%B1.png)

广播可能将到达一些不属于该组成员的路由器，是一种浪费

通过修剪广播生成树把不通往组成员的链路从树中删掉，得到的结果是一棵组播树

- MOSPF 组播OSPF协议
- 距离矢量组播路由协议



#### 移动主机路由

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%A7%BB%E5%8A%A8%E4%B8%BB%E6%9C%BA%E8%B7%AF%E7%94%B1.png)

典型的登录过程：

1. 外地代理定期广播分组，宣布自己的存在及地址；同时，移动主机可以广播，问“这里有没有外地代理？”
2. 移动主机登录到外地代理
3. 外地代理与移动主机的本地代理联系
4. 本地代理检查安全性信息
5. 外地代理得到本地代理的确认后，建立一个表项，并通知移动主机已经登录了退出登录



### ※拥塞控制算法

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%8B%A5%E5%A1%9E.png)

#### 流量感知路由

把链路权重设置成一个链路带宽，传输延迟，测量负载或平均排队延迟的函数，进行路由

缺点：路由表可能会剧烈地摇摆不定，从而导致不稳定地路由和许多其他问题

Intermet路由协议通常不依赖于负载来调整自己的路由，而是在路由协议外部通过慢慢改变它的输入来调整路由。这种方法就是所谓的流量工程



#### 准入控制

广泛应用于虚电路网络

除非网络可以携带额外的流量而不会变得拥塞，否则不再建立新的虚电路

准入控制还可以和流量感知路由相结合，在虚电路建立过程中，绕开流量热点区域的路由,如下图所示

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6.png)

重画网络，去掉拥塞的路由器和它们所有的线路



#### 流量调节

发送方调节它们的传输速度以便发送网络能实际传输的流量

路由器必须把反馈信息传递给造成拥塞的发送方

**抑制包**

通过发送抑制包(choke packet)给发送方，使发送方减少发送的流量 

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%8A%91%E5%88%B6%E5%8C%85.png)

a中抑制包只映像端源

b中抑制包在沿途的每一条都发挥作用，拥塞点上的拥塞现象很快得到缓解

代价：上有路径需要消耗更多缓冲区空间



这种方法将拥塞消灭在萌芽状态，不会丢失任何数据包

**显示拥塞通知** ECN

使用数据包头的两位来记录数据包是否经历拥塞(开始发出时没有标记，经历拥塞路由器后，路由器转发时会给数据包打上标记)，接收方接收到该数据包后，在它的下一个应答数据包里回显该标志位显示拥塞信号

#### 负载脱落 load shedding

路由器因为来不及处理数据包而面临被数据包淹没的危险时，就将它们丢弃。

葡萄酒策略：旧的比新的好，先丢弃新的数据包

牛奶策略：新的比旧的好



#### 随机早期检测 RED

路由器维护一个运行队列长度的平均值

当某条链路上的平均队列长度超过某个阈值时，该链路就被认为即将拥塞，因此路由器随机丢弃一小部分数据包。

随机选择丢弃的数据包使得快速发送方发现丢包的可能性更大

受此影响的发送方就会发现丢包，然后传输协议将放慢速度



与上面提到的ECN 效果类似，但RED是隐式的



### 服务质量

从源端发到接收方的数据包叫做一个流

流的需求可以通过四个主要参数来表示：带宽、延迟、抖动和丢失

不同应用程序对这四个参数的要求不同



#### **提供好的服务质量的技术**

Overprovisioning 过度配置

供如此大的路由器容量、缓冲空间和带宽，使数据包轻松传输



简单、有效、但代价很高



在接收方进行数据包的缓冲

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E6%8D%AE%E5%8C%85%E7%BC%93%E5%86%B2.png)

接收方将到达的数据包进行短时间的缓冲



#### 流量整型策略

流量整型是指调节进入网络的数据流的平均速率和突发性的技术。允许应用程序发送适合它们需求的各种各样的流量，包括某种程度的突发



**漏桶和令牌桶**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%BC%8F%E6%A1%B6%E5%92%8C%E4%BB%A4%E7%89%8C%E6%A1%B6.png)



每个主机在连接到网络的接口中包含一个漏桶

- 相网络发送数据包，必须有可能往漏桶中灌入更多的水
- 桶满时，数据包必须进入队列等待漏桶空出来时再接纳，或者被丢弃



令牌桶

- 为了发送一个数据包，必须从桶内拿出水或令牌，俗称为内容
- 如果桶为空，必须等待更多的令牌到达才能发送另一个数据包



漏桶和令牌桶限制了一个流的长期速率，但允许其短期突发某个最高调节长度，不会改变延迟也不会受到任何人为的拖延。大量的突发数据将被一个漏桶流量整形器进行平滑处理，以便减少网络拥塞



最大突发速率的长度
$$
B+RS=MS
$$
M 最大发送速率



#### 包调度

同一个流的数据包之间以及再竞争流之间分配路由器的算法称为包调度算法

资源：带宽、缓冲区、CPU周期



**包调度算法**

- FCFS 先到先服务 FIFO

FIFO再队列满时通常丢弃新到的数据包 **尾丢包**

易于实现，但无法提供良好的服务质量

- 公平队列算法

对每条输出线路，路由器位每个流设置单独的队列，空闲时，路由器循环扫描各个队列，从下一个队列中取出第一个数据包发送

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%85%AC%E5%B9%B3%E9%98%9F%E5%88%97.png)

优点：所有的流量以同样的速率发送数据包

缺陷：给使用大数据包的主机更多的带宽



- 加权队列算法

计算一个虚拟时间，这个时间指每个数据包发送完毕所需的轮数

按顺序发送数据包



### Internet的网络层

#### IPV4协议

**Ipv4协议头**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E6%95%B0%E6%8D%AE%E6%8A%A5.png)

Version：数据报属于协议的哪个版本

IHL：Ip头长，最小值为5，最大值为15，以4字节为单位

Differentiated services:前6位标识数据报服务类型，后2位携带显示拥塞信息 不需要掌握

Total length：数字报总长度，单位是1字节，包括头长度的数据长度

Identification 标识值：让目标主机确定一个新到达的分段属于哪个数据报，同一个数据报的所有段具有相同的标识值

DF代表不分段

MF代表更多的端，Fragment offset 段偏移量指明该段再数据报中的位置

Time to live 用于限制数据包生存期的计数器 到达0时丢弃数据包

Protocol字段指明将它交给哪个传输进程(TCP/UDP...)

Header checksum：头校验和

Source address：源网络接口的IP地址

Destination address ：目标网络接口的IP地址

选项：提供一种途径，允许后续版本协议包含一些原设计中没有出现的信息

每个选项的第一个字节时一个标识码，标明选项类别，有的选项后面跟着1字节的选项长度字段，然后时一个或多个数据字节(感觉没什么用，了解就好)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E9%80%89%E9%A1%B9.png)



#### IP地址

IP地址由前缀和主机号组成

Ipv4 32位

Ipv6 128位



**IP地址分类**

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png)

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%89%B9%E6%AE%8A%E7%9A%84IP%E5%9C%B0%E5%9D%80.png)

每一台主机分配唯一的IP地址(动态分配，违背该原则)

主机位不能是全0或者全1（避免与子网和广播混淆）



#### 子网和子网划分技术

为什么需要子网？

进行流量分流，便于管理



如何划分子网？ 从主机号中拿出几位来标识子网

子网掩码：

点分十进制 网络号，子网号全1，网络号全0

标记位长 255.255.252.0/22 子网掩码前缀为22

前缀与主机号的分界符



确定前缀与主机地址

将IP地址与子网掩码两个二进制数逻辑与运算后得出的结果就是IP前缀

子网掩码取反再与IP地址逻辑与运算后得到的就是主机部分



#### 无类别域间路由CIDR

IP分类的缺点： 有的分配太多用不完，有的分配太少，不够用

以可变长分块的方式分配所剩的C 类网络地址

C 类地址分配规则:

欧洲(194-195) 北美(198-199) 中美南美(200-201) 亚洲太平洋地区(202-203)

分组到达欧洲,要更详细的路由选择表:将目的地址屏蔽,再与其中表目比较,以找到相匹配的地址.

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%B8%80%E7%BB%84%E5%88%86%E9%85%8D%E7%9A%84IP%E5%9C%B0%E5%9D%80.png)

分配的原则是：一个网路只能有一个网络号，进行 IP 地址分配时尽可能连续分配。以
牛津大学为例，尽管前面余下 210 个空白，但是依旧选择向后

路由聚合 rounte aggregation：为了减小路由表长度，将多个小前缀地址块合并为
一个大前缀地址块，如上面的三个地址就可以聚合成一个地址，方法是将三者网络号最大公
共部分聚合为新网络号

194.24.0.0/21
194.24.8.0/22	→ 194.24.0.0/19
194.24.16.0/20

就可以将三个路由表项合成一个，其下一跳是伦敦。但由此带来一个问题：如果
上面空白的那部分被分配给非洲某学校，那么空白部分就会被错误的聚合。因此要在路由表
中新增一项单独指明空白部分的下一跳。

在没有聚合时，查路由只需要找到匹配的一项就可以跳到下一跳，但是有聚合以
后，需要寻找路由表项中的最长匹配



当新的消息进入路由器时，首先进入等待队列，通过一定
的调度策略进行调度。调度到这个消息时，获取其目的地址，将目的地址分别与路由表中的
每一项网络号的子网掩码进行比对，选取最长匹配的网络表项进行转发。当然，没有查询到
匹配的时候，转发到缺省表项，也就是给上一层路由，继续寻找



#### NAT 网络地址转换

SP为每个家庭或每个公司分配一个地址(或者，最多分配少量的IP 地址)，用这个IP地址来传输 Internet 流量。

在客户网络内部，每台计算机有唯一的IP地址，该地址主要用来路由内部流量。

当一个数据包需要离开客户网络，发向其他 ISP 时，它必须执行一个地址转换，把唯一的内部IP 地址转换成那个共享的公共 IP 地址。



NAT BOX/防火墙

当一个内部数据包向外传输时，NATBOX将数据包的IP源地址转换为公司真正拥有的IP地址

防火墙提供一个安全保护机制，仔细控制进出客户网络的流量



当数据包返回时

NAT 

TCP/UDP协议头部包含了一个源端口和目的端口字段

建立一张映射表

使用源端口字段，可以解决映射问题

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/nat.png)

当一个数据包到达NAT时，源端口字段被从TCP的头部中提取出来

并用作索引值来查找NATbox的映射表,从对应的表项中提取出内部的IP地址

以及它对应的端口号，将它插入到数据包中，并将它传递给用户内部的路由器



缺陷：

1. 违反了IP的结构模型（每台主机拥有唯一的IP地址）

2. Nat打破了Internet端对端的连接模型
3. NAT将Internet从无连接网络，改变到了具有面向连接特性的形式，NAT BOX崩溃，映射表丢失，所有TCP连接都会摧毁

4. NAT违反了最基本的协议分层规则，破坏了层与层之间的独立性

5. Internet上的进程可能不适用TCP和UDP协议



处理地址短缺的`权宜之计`



### Internet控制协议

#### ICMP 控制消息协议

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/ICMP%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B.png)

路由器严密监视 Internet 的操作。当路由器在处理一个数据包的过程中发生了意外，可通过 Internet 控制消息协议(ICMP，Intemet Control Message Protocol)向数据包的源端报告有关事件

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/ICMP.png)



#### ARP 地址解析协议

主机想要发送数据包，必须知道IP地址(从DNS域名系统查找)和MAC地址

如果不知道MAC地址，主机会发送广播包(ARP请求报文)到以太网上请求拥有目的IP地址的主机返回其的MAC地址

目的主机以自己的以太网地址作为应答

优点：简单，只需配置好IP地址，确定子网掩码，不需做任何事情



ARP优化：==将ARP结果缓存起来==(缓存项应该在几分钟之后超时)

保持缓存信息最新状态 并能优化性能的一种更聪明方式是，让每台机器配置之后广播它的地址映射关系



如果两台主机不在同一个以太网中怎么办?

路由器不转发以太网级别的广播信息，主机将发往其他网络的广播信息发送给本地代理

#### RARP协议

由已知硬件地址查找IP地址的过程叫做反向地址解析



#### DHCP动态主机配置协议

采用DHCP时，每个网络必须有一个DHCP服务器负责地址配置

当计算机启动时，它只有一个MAC地址(或者其他数据链路层地址)没有IP地址

计算机在自己的网络上广播一个报文，请求IP地址(DHCP DISCOVERY包)

如果DHCP服务器不在本地网络上，必须将路由器配置成可以接受DHCP广播并将该请求报文中继给DHCP服务器，

DHCP服务器收到这个请求，为主机分配一个空闲的IP地址，通过DHCP OFFER包返回给主机(可能需要路由器中继)，服务器用主机的以太网地址来标识这台主句(因为没有IP地址)



问题：一个地址池中取出的IP地址分配给主机能用多久?

为每个分配的IP地址指定一段固定时间(租赁)，租赁期满前，主机必须请求DHCP续订，若没有续订或请求被拒绝，则主机不能使用以前分配给它的IP地址



#### OSPF 开放最短路径优先

在一个组织网络内部，可以使用自己的内部路由算法（域内路由算法）

域内路由协议，也成为内部网关协议



OSPF是一种链路状态路由协议,回看上面的路由算法

#### BGP 边界网关协议

![](image/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/BGP.png)

自治系统AS内部可以使用自己的内部路由协议

而AS之间可以使用BGP协议

BGP协议必须考虑大量宗教、经济、安全、性能等方面的因素

BGP-距离矢量路由算法的升级版

交换信息的过程中，交换完整的链路信息(避免了环路)
